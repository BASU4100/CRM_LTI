<!-- <div class="container">
  <h2>Update Booking</h2>

  <form [formGroup]="itemForm" (ngSubmit)="onSubmit()">
    <div class="form-group">
      <label for="status">Booking Status</label>
      <input id="status" formControlName="status" class="form-control" />
      <div *ngIf="itemForm.get('status')?.invalid && itemForm.get('status')?.touched" class="text-danger">
        Status is required.
      </div>
    </div>

    <div class="form-group">
      <label for="amount">Amount</label>
      <input id="amount" type="number" formControlName="amount" class="form-control" />
      <div *ngIf="itemForm.get('amount')?.invalid && itemForm.get('amount')?.touched" class="text-danger">
        Amount must be a positive number.
      </div>
    </div>

    <div class="form-group">
      <label for="paymentDate">Payment Date</label>
      <input id="paymentDate" type="date" formControlName="paymentDate" class="form-control" />
      <div *ngIf="itemForm.get('paymentDate')?.invalid && itemForm.get('paymentDate')?.touched" class="text-danger">
        Payment date is required.
      </div>
    </div>

    <div class="form-group">
      <label for="paymentMethod">Payment Method</label>
      <select id="paymentMethod" formControlName="paymentMethod" class="form-control">
        <option value="">Select Method</option>
        <option value="CREDIT_CARD">Credit Card</option>
        <option value="DEBIT_CARD">Debit Card</option>
        <option value="UPI">UPI</option>
        <option value="CASH">Cash</option>
      </select>
      <div *ngIf="itemForm.get('paymentMethod')?.invalid && itemForm.get('paymentMethod')?.touched" class="text-danger">
        Payment method is required.
      </div>
    </div>

    <div class="form-group">
      <label for="paymentStatus">Payment Status</label>
      <select id="paymentStatus" formControlName="paymentStatus" class="form-control">
        <option value="">Select Status</option>
        <option value="COMPLETED">Completed</option>
        <option value="PENDING">Pending</option>
        <option value="FAILED">Failed</option>
      </select>
      <div *ngIf="itemForm.get('paymentStatus')?.invalid && itemForm.get('paymentStatus')?.touched" class="text-danger">
        Payment status is required.
      </div>
    </div>

    <button type="submit" class="btn btn-primary" [disabled]="!itemForm.valid">Update Booking</button>

    <div *ngIf="itemForm.valid" class="alert alert-success mt-3">
      ✅ Form is valid and ready to submit.
    </div>
  </form>

  <div *ngIf="showError" class="alert alert-danger mt-3">
    {{ errorMessage }}
  </div>

  <div *ngIf="showMessage" class="alert alert-success mt-3">
    {{ responseMessage }}
  </div>
</div> -->
<div class="container py-4"> <!-- ==================== SUCCESS / ERROR ==================== -->
  <div *ngIf="showMessage" class="alert alert-success alert-dismissible fade show"> {{ responseMessage }} <button
      type="button" class="btn-close" (click)="showMessage=false"></button> </div>
  <div *ngIf="showError" class="alert alert-danger alert-dismissible fade show"> {{ errorMessage }} <button
      type="button" class="btn-close" (click)="showError=false"></button> </div>
  <!-- ==================== BOOKINGS TABLE ==================== -->
  <h2 class="mb-4">Bookings (Agent View)</h2>
  <div class="table-responsive mb-5">
    <table class="table table-striped table-hover align-middle">
      <thead class="table-dark">
        <tr>
          <th>#</th>
          <th>Car</th>
          <th>Customer</th>
          <th>Start</th>
          <th>End</th>
          <th>Status</th>
          <th>Amount</th>
          <th>Payment</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let b of bookingList; let i = index">
          <td>{{ i + 1 }}</td>
          <td>{{ b.car?.model || '-' }} ({{ b.car?.plateNumber }})</td>
          <td>{{ b.customer?.name || '-' }}</td>
          <td>{{ b.rentalStartDate }}</td>
          <td>{{ b.rentalEndDate }}</td>
          <td> <span class="badge"
              [ngClass]="{ 'bg-warning': b.status === 'pending', 'bg-success': b.status === 'booked', 'bg-secondary': b.status === 'cancelled' }">
              {{ b.status | uppercase }} </span> </td>
          <td>{{ b.totalAmount | currency:'USD':'symbol':'1.2-2' }}</td>
          <td> <span class="badge"
              [ngClass]="{ 'bg-success': b.payment?.paymentStatus === 'COMPLETED', 'bg-danger': b.payment?.paymentStatus === 'FAILED', 'bg-secondary': !b.payment }">
              {{ b.payment?.paymentStatus || '—' }} </span> </td>
          <td> <!-- BOOK NOW --> <button class="btn btn-sm btn-outline-primary me-2" [disabled]="b.status !== 'pending'"
              (click)="bookNow(b)" title="Mark as booked"> Book Now </button> <!-- PAYMENT --> <button
              class="btn btn-sm btn-outline-success" [disabled]="b.payment?.paymentStatus === 'COMPLETED'"
              (click)="payment(b)" title="Record payment"> Payment </button> </td>
        </tr>
      </tbody>
    </table>
  </div> <!-- ==================== FORM (STATUS + PAYMENT) ==================== -->
  <div *ngIf="selectedBooking" class="card">
    <div class="card-header"> <strong> {{ updateId ? 'Update Booking Status' : 'Record Payment' }} – #{{
        selectedBooking.id }} </strong> </div>
    <div class="card-body">
      <form [formGroup]="itemForm" (ngSubmit)="updateId ? onStatusSubmit() : onPaymentSubmit()">
        <!-- STATUS (only shown for Book-Now) -->
        <div class="mb-3" *ngIf="updateId"> <label class="form-label">Current Status</label> <input type="text"
            class="form-control" [value]="selectedBooking.status" disabled> </div> <!-- AMOUNT -->
        <div class="mb-3"> <label for="amount" class="form-label">Amount <span class="text-danger">*</span></label>
          <input id="amount" type="number" formControlName="amount" class="form-control"
            [class.is-invalid]="itemForm.get('amount')?.invalid && itemForm.get('amount')?.touched">
          <div class="invalid-feedback"> Amount is required and must be ≥ 0. </div>
        </div> <!-- PAYMENT DATE -->
        <div class="mb-3"> <label for="paymentDate" class="form-label">Payment Date <span
              class="text-danger">*</span></label> <input id="paymentDate" type="date" formControlName="paymentDate"
            class="form-control"
            [class.is-invalid]="itemForm.get('paymentDate')?.invalid && itemForm.get('paymentDate')?.touched">
          <div class="invalid-feedback">Date is required.</div>
        </div> <!-- PAYMENT METHOD -->
        <div class="mb-3"> <label for="paymentMethod" class="form-label">Method <span
              class="text-danger">*</span></label> <select id="paymentMethod" formControlName="paymentMethod"
            class="form-select"
            [class.is-invalid]="itemForm.get('paymentMethod')?.invalid && itemForm.get('paymentMethod')?.touched">
            <option value="">-- Select --</option>
            <option value="CREDIT_CARD">Credit Card</option>
            <option value="DEBIT_CARD">Debit Card</option>
            <option value="UPI">UPI</option>
            <option value="CASH">Cash</option>
          </select>
          <div class="invalid-feedback">Method required.</div>
        </div> <!-- PAYMENT STATUS -->
        <div class="mb-3"> <label for="paymentStatus" class="form-label">Payment Status <span
              class="text-danger">*</span></label> <select id="paymentStatus" formControlName="paymentStatus"
            class="form-select"
            [class.is-invalid]="itemForm.get('paymentStatus')?.invalid && itemForm.get('paymentStatus')?.touched">
            <option value="">-- Select --</option>
            <option value="COMPLETED">Completed</option>
            <option value="PENDING">Pending</option>
            <option value="FAILED">Failed</option>
          </select>
          <div class="invalid-feedback">Status required.</div>
        </div>
        <div class="d-flex gap-2"> <button type="submit" class="btn btn-primary" [disabled]="itemForm.invalid"> {{
            updateId ? 'Confirm Booking' : 'Save Payment' }} </button> <button type="button" class="btn btn-secondary"
            (click)="resetSelection()"> Cancel </button> </div>
      </form>
    </div>
  </div>
</div>